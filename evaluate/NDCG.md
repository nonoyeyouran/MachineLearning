# NDCG（Normalized Discounted Cumulative Gain）指标详述

## 目录
1. [NDCG 的定义](#1-ndcg-的定义)
2. [NDCG 的计算步骤](#2-ndcg-的计算步骤)
   - [(1) 计算 Gain（增益）](#1-计算-gain增益)
   - [(2) 计算 Discounted Gain（折扣增益）](#2-计算-discounted-gain折扣增益)
   - [(3) 计算 Cumulative Gain（累计增益）](#3-计算-cumulative-gain累计增益)
   - [(4) 计算 Ideal DCG（理想折扣累计增益）](#4-计算-ideal-dcg理想折扣累计增益)
   - [(5) 计算 NDCG（归一化折扣累计增益）](#5-计算-ndcg归一化折扣累计增益)
3. [NDCG 的特点](#3-ndcg-的特点)
4. [NDCG 的优缺点](#4-ndcg-的优缺点)
   - [优点](#优点)
   - [缺点](#缺点)
5. [NDCG 的应用场景](#5-ndcg-的应用场景)
6. [NDCG 的示例](#6-ndcg-的示例)
7. [总结](#7-总结)

---

## 1. NDCG 的定义
**NDCG（Normalized Discounted Cumulative Gain，归一化折扣累计增益）** 是推荐系统和信息检索领域中常用的评估指标，用于衡量推荐列表或搜索结果的质量。NDCG 不仅考虑推荐物品的相关性，还考虑物品在推荐列表中的排序位置，能够有效评估推荐系统的排序性能。

---

## 2. NDCG 的计算步骤
NDCG 的计算分为以下几个步骤：

### (1) 计算 Gain（增益）
- **Gain** 表示推荐列表中每个物品的相关性得分。
- 对于二分类问题，相关性得分通常为 1（相关）或 0（不相关）。
- 对于多级相关性（如评分数据），相关性得分可以是具体的评分值（如 1 到 5 分）。

公式：
\[
\text{Gain}_i = \text{rel}_i
\]
其中 \( \text{rel}_i \) 是第 \( i \) 个物品的相关性得分。

---

### (2) 计算 Discounted Gain（折扣增益）
- **Discounted Gain** 对 Gain 进行折扣，以反映物品在推荐列表中的位置。
- 排名越靠后，折扣越大，因为用户更关注排名靠前的物品。

公式：
\[
\text{Discounted Gain}_i = \frac{\text{Gain}_i}{\log_2(i + 1)}
\]
其中 \( i \) 是物品在推荐列表中的位置（从 1 开始）。

---

### (3) 计算 Cumulative Gain（累计增益）
- **Cumulative Gain（CG）** 是推荐列表中前 \( K \) 个物品的 Gain 之和。
- **Discounted Cumulative Gain（DCG）** 是推荐列表中前 \( K \) 个物品的 Discounted Gain 之和。

公式：
\[
\text{DCG@K} = \sum_{i=1}^{K} \frac{\text{rel}_i}{\log_2(i + 1)}
\]

---

### (4) 计算 Ideal DCG（理想折扣累计增益）
- **Ideal DCG（IDCG）** 是理想情况下（推荐列表按相关性从高到低排序）的 DCG。
- 计算 IDCG 时，先对所有物品的相关性得分从高到低排序，然后计算 DCG。

公式：
\[
\text{IDCG@K} = \sum_{i=1}^{K} \frac{\text{rel}_i^{\text{sorted}}}{\log_2(i + 1)}
\]
其中 \( \text{rel}_i^{\text{sorted}} \) 是按相关性从高到低排序后的第 \( i \) 个物品的相关性得分。

---

### (5) 计算 NDCG（归一化折扣累计增益）
- **NDCG** 是 DCG 与 IDCG 的比值，用于归一化 DCG，使其取值范围在 [0, 1] 之间。

公式：
\[
\text{NDCG@K} = \frac{\text{DCG@K}}{\text{IDCG@K}}
\]

---

## 3. NDCG 的特点
- **考虑排序**：NDCG 不仅关注推荐物品的相关性，还考虑物品在推荐列表中的排序位置。
- **多级相关性支持**：NDCG 适用于多级相关性数据（如评分数据），而不仅仅是二分类数据。
- **归一化**：NDCG 通过归一化处理，使得不同推荐列表之间的比较更加公平。

---

## 4. NDCG 的优缺点

### 优点
- **排序敏感**：NDCG 能够有效评估推荐列表的排序质量。
- **多级相关性支持**：适用于多级相关性数据，能够更细致地衡量推荐性能。
- **归一化**：通过归一化处理，NDCG 的取值范围在 [0, 1] 之间，便于比较。

### 缺点
- **计算复杂度较高**：需要计算 DCG 和 IDCG，计算量较大。
- **对长尾物品不敏感**：NDCG 主要关注排名靠前的物品，可能忽略长尾物品的推荐效果。

---

## 5. NDCG 的应用场景
- **推荐系统**：评估推荐列表的排序质量，尤其是在多级相关性数据（如评分数据）中。
- **信息检索**：评估搜索引擎返回结果的排序质量。
- **广告推荐**：评估广告推荐的相关性和排序效果。

---

## 6. NDCG 的示例
假设有以下推荐列表和相关性得分（评分范围为 0 到 5）：

| 排名 \( i \) | 物品 | 相关性得分 \( \text{rel}_i \) |
|--------------|------|-------------------------------|
| 1            | A    | 3                             |
| 2            | B    | 2                             |
| 3            | C    | 5                             |
| 4            | D    | 0                             |
| 5            | E    | 1                             |

### 计算 DCG@5
\[
\text{DCG@5} = \frac{3}{\log_2(2)} + \frac{2}{\log_2(3)} + \frac{5}{\log_2(4)} + \frac{0}{\log_2(5)} + \frac{1}{\log_2(6)}
\]
\[
\text{DCG@5} = \frac{3}{1} + \frac{2}{1.585} + \frac{5}{2} + \frac{0}{2.322} + \frac{1}{2.585} \approx 3 + 1.262 + 2.5 + 0 + 0.387 \approx 7.149
\]

### 计算 IDCG@5
将相关性得分从高到低排序：5, 3, 2, 1, 0。

\[
\text{IDCG@5} = \frac{5}{\log_2(2)} + \frac{3}{\log_2(3)} + \frac{2}{\log_2(4)} + \frac{1}{\log_2(5)} + \frac{0}{\log_2(6)}
\]
\[
\text{IDCG@5} = \frac{5}{1} + \frac{3}{1.585} + \frac{2}{2} + \frac{1}{2.322} + \frac{0}{2.585} \approx 5 + 1.893 + 1 + 0.431 + 0 \approx 8.324
\]

### 计算 NDCG@5
\[
\text{NDCG@5} = \frac{\text{DCG@5}}{\text{IDCG@5}} = \frac{7.149}{8.324} \approx 0.859
\]

---

## 7. 总结
- **NDCG** 是推荐系统和信息检索领域中重要的评估指标，能够有效衡量推荐列表的排序质量。
- NDCG 通过折扣增益和归一化处理，综合考虑了推荐物品的相关性和排序位置。
- NDCG 适用于多级相关性数据，但在计算复杂度和长尾物品评估方面存在一定局限性。
- 在实际应用中，NDCG 通常与其他指标（如召回率、精确率等）结合使用，以全面评估推荐系统的性能。
