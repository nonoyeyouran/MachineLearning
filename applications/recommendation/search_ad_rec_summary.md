# 搜广推系统的一般过程（搜索广告与推荐系统的合并与对比，补充Query-广告相关性阶段和粗排阶段）

## 目录
1. [共同部分](#共同部分)
   - 1.1 [数据收集与预处理](#数据收集与预处理)
   - 1.2 [候选集生成（召回阶段）](#候选集生成召回阶段)
   - 1.3 [候选集排序（精排阶段）](#候选集排序精排阶段)
   - 1.4 [展示与反馈](#展示与反馈)
   - 1.5 [模型训练与优化](#模型训练与优化)
   - 1.6 [反作弊与风控](#反作弊与风控)
2. [不同部分](#不同部分)
   - 2.1 [搜索广告系统的独特部分](#搜索广告系统的独特部分)
     - 2.1.1 [查询理解](#查询理解)
     - 2.1.2 [Query-广告相关性阶段](#query-广告相关性阶段)
     - 2.1.3 [广告出价与竞价](#广告出价与竞价)
   - 2.2 [推荐系统的独特部分](#推荐系统的独特部分)
     - 2.2.1 [粗排阶段](#粗排阶段)
     - 2.2.2 [重排序与多样性优化](#重排序与多样性优化)
     - 2.2.3 [冷启动问题](#冷启动问题)
3. [对比表格](#对比表格)
4. [总结](#总结)

---

## 1. 共同部分

### 1.1 数据收集与预处理
- **目标**：收集用户行为数据和物品/广告信息，并进行清洗和预处理。
- **任务**：
  - 收集用户行为数据（如点击、购买、评分）。
  - 清洗和标注数据。
  - 提取用户和物品/广告的特征（如用户画像、物品类别）。

### 1.2 候选集生成（召回阶段）
- **目标**：从海量候选集中快速筛选出与用户兴趣相关的候选物品/广告。
- **任务**：
  - 协同过滤：基于用户历史行为召回相似物品/广告。
  - 基于内容的召回：利用物品/广告的文本、图像等特征召回相似候选。
  - 图召回：通过图神经网络（GNN）挖掘用户与物品/广告的复杂关系。

### 1.3 候选集排序（精排阶段）
- **目标**：对召回阶段的候选集进行精细化排序，以最大化用户体验或商业目标。
- **任务**：
  - CTR预估：预测用户对物品/广告的点击概率。
  - 多目标优化：结合CTR、CVR等指标进行综合排序。
  - 深度学习模型：如Wide & Deep、DeepFM，捕捉高阶特征交互。

### 1.4 展示与反馈
- **目标**：将最终结果展示给用户，并收集用户反馈以优化模型。
- **任务**：
  - 展示推荐结果或广告。
  - 记录用户的点击、购买等行为数据。
  - 实时更新模型和策略。

### 1.5 模型训练与优化
- **目标**：利用用户反馈数据持续优化系统模型。
- **任务**：
  - 数据预处理和特征工程。
  - 训练CTR预估、CVR预估等模型。
  - 通过A/B测试评估模型效果。

### 1.6 反作弊与风控
- **目标**：检测和防止系统中的作弊行为，保障用户体验和平台利益。
- **任务**：
  - 通过规则和机器学习模型识别异常行为。
  - 制定和实施风控策略。
  - 实时监控系统运行状态。

---

## 2. 不同部分

### 2.1 搜索广告系统的独特部分

#### 2.1.1 查询理解
- **目标**：理解用户的搜索意图，提取查询中的关键信息。
- **任务**：
  - 分词与词性标注。
  - 实体识别和意图识别。
  - 查询扩展（如同义词、近义词扩展）。

#### 2.1.2 Query-广告相关性阶段
- **目标**：计算用户查询（Query）与广告内容的相关性，确保广告与用户意图匹配。
- **任务**：
  - 文本匹配：通过TF-IDF、BM25等算法计算Query与广告文本的相关性。
  - 语义匹配：利用Embedding技术（如BERT）计算Query与广告的语义相似度。
  - 上下文匹配：结合用户上下文（如地理位置、设备类型）计算相关性。

#### 2.1.3 广告出价与竞价
- **目标**：通过竞价机制确定广告的展示顺序和价格，优化广告主收益和平台收入。
- **任务**：
  - 广义第二价格拍卖（GSP）。
  - 实时竞价（RTB）。
  - 预算控制和出价策略优化。

### 2.2 推荐系统的独特部分

#### 2.2.1 粗排阶段
- **目标**：在召回和精排之间增加一个粗排阶段，快速筛选出高质量候选集，减少精排的计算负担。
- **任务**：
  - 使用轻量级模型（如LR、GBDT）对召回结果进行初步排序。
  - 结合用户画像和物品特征进行快速筛选。
  - 保留Top-K候选集供精排阶段进一步处理。

#### 2.2.2 重排序与多样性优化
- **目标**：在排序结果的基础上，进一步优化推荐的多样性和用户体验。
- **任务**：
  - 通过多样性算法（如MMR）增加推荐结果的多样性。
  - 结合用户当前上下文（如时间、地点）调整推荐结果。
  - 去重与过滤。

#### 2.2.3 冷启动问题
- **目标**：解决新用户或新物品的推荐问题。
- **任务**：
  - 基于内容的推荐：利用物品的文本、图像等特征进行推荐。
  - 利用迁移学习或元学习技术缓解冷启动问题。

---

## 3. 对比表格

| **阶段**               | **搜索广告系统**                          | **推荐系统**                          | **共同点**                          |
|------------------------|------------------------------------------|--------------------------------------|------------------------------------|
| **数据收集与预处理**   | 收集用户行为数据和广告信息                | 收集用户行为数据和物品信息            | 数据清洗、特征工程                 |
| **候选集生成**         | 基于关键词匹配、用户画像匹配              | 基于协同过滤、内容召回                | 图召回、热门召回                   |
| **粗排阶段**           | 无                                       | 使用轻量级模型快速筛选候选集          | 无                                 |
| **候选集排序（精排）** | CTR预估、eCPM排序                        | CTR预估、多目标排序                   | 深度学习模型、多目标优化           |
| **展示与反馈**         | 广告展示、用户反馈收集                    | 推荐展示、用户反馈收集                | 实时更新模型                       |
| **模型训练与优化**     | 训练CTR预估、CVR预估模型                  | 训练CTR预估、CVR预估模型              | A/B测试、模型评估                  |
| **反作弊与风控**       | 检测广告点击欺诈、刷单行为                | 检测推荐点击欺诈、刷评分行为          | 规则和机器学习模型                 |
| **查询理解**           | 分词、实体识别、意图识别                  | 无                                   | 无                                 |
| **Query-广告相关性**   | 计算Query与广告的相关性                   | 无                                   | 无                                 |
| **广告出价与竞价**     | GSP、RTB、预算控制                        | 无                                   | 无                                 |
| **重排序与多样性优化** | 无                                       | 多样性优化、上下文感知                | 无                                 |
| **冷启动问题**         | 无                                       | 基于内容的推荐、迁移学习              | 无                                 |

---

## 4. 总结

搜索广告系统和推荐系统在数据收集、候选集生成、精排、展示与反馈等阶段具有高度相似性，但在查询理解、Query-广告相关性、广告出价与竞价、粗排、重排序与多样性优化等方面存在显著差异。通过合并共同部分并分别阐述不同部分，可以更清晰地理解两者的异同。未来，随着技术的不断发展，搜索广告系统和推荐系统将进一步融合，共同推动个性化服务的创新与应用。
